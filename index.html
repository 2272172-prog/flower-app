<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Flower Shop</title>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  background: #fff;
}

#app {
  padding-bottom: 90px;
}

.topbar {
  height: 60px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 600;
  border-bottom: 1px solid #eee;
}

.content {
  padding: 16px;
}

.bottom-nav {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  height: 75px;
  background: #fff;
  border-top: 1px solid #eee;
  display: flex;
  justify-content: space-around;
  align-items: center;
}

.nav-item {
  font-size: 12px;
  text-align: center;
  color: #888;
}

.nav-item.active {
  color: #2AABEE;
  font-weight: 600;
}

.card {
  border-radius: 16px;
  overflow: hidden;
  margin-bottom: 14px;
}

.card img {
  width: 100%;
  height: 200px;
  object-fit: cover;
}
</style>
</head>

<body>

<div id="app"></div>

<script>
/* ---------------- CONFIG ---------------- */

const firebaseConfig = {
  apiKey: "–¢–í–û–ô_API_KEY",
  authDomain: "flower-app-5a32c.firebaseapp.com",
  projectId: "flower-app-5a32c",
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

/* ---------------- STATE ---------------- */

let state = {
  screen: "home",
  products: [],
  selectedProduct: null,
  cart: [],
  favorites: []
};

/* ---------------- INIT ---------------- */

function init() {
  loadProducts();
  render();
}

function loadProducts() {
  db.collection("flowers").get().then(snapshot => {
    state.products = snapshot.docs.map(doc => ({
      id: doc.id,
      ...doc.data()
    }));
    render();
  });
}

/* ---------------- NAVIGATION ---------------- */

function navigate(screen, product = null) {
  state.screen = screen;
  state.selectedProduct = product;
  render();
}

/* ---------------- RENDER ---------------- */

function render() {
  const app = document.getElementById("app");

  if (state.screen === "home") renderHome(app);
  if (state.screen === "product") renderProduct(app);
  if (state.screen === "cart") renderCart(app);
  if (state.screen === "favorites") renderFavorites(app);
  if (state.screen === "profile") renderProfile(app);
}

/* ---------------- SCREENS ---------------- */

function renderHome(app) {
  app.innerHTML = `
    <div class="topbar">Flower Shop</div>
    <div class="content">
      ${state.products.map(p => `
        <div class="card" onclick="navigate('product', '${p.id}')">
          <img src="${p.image}">
          <div style="padding:10px;">
            <div style="font-weight:600;">${p.name}</div>
            <div>${p.price} ‚ÇΩ</div>
          </div>
        </div>
      `).join("")}
    </div>
    ${renderNav("home")}
  `;
}

function renderProduct(app) {
  const product = state.products.find(p => p.id === state.selectedProduct);

  app.innerHTML = `
    <div class="topbar">
      <span onclick="navigate('home')" style="position:absolute;left:16px;">‚Üê</span>
      ${product.name}
    </div>
    <div class="content">
      <img src="${product.image}" style="width:100%;border-radius:20px;">
      <h2>${product.price} ‚ÇΩ</h2>
      <button onclick="addToCart('${product.id}')"
        style="width:100%;padding:14px;background:#2AABEE;color:#fff;border:none;border-radius:12px;">
        –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É
      </button>
    </div>
  `;
}

function renderCart(app) {
  app.innerHTML = `
    <div class="topbar">–ö–æ—Ä–∑–∏–Ω–∞</div>
    <div class="content">
      ${state.cart.map(id => {
        const p = state.products.find(x => x.id === id);
        return `<div>${p.name} ‚Äî ${p.price} ‚ÇΩ</div>`;
      }).join("")}
    </div>
    ${renderNav("cart")}
  `;
}

function renderFavorites(app) {
  app.innerHTML = `
    <div class="topbar">–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</div>
    <div class="content">
      ${state.favorites.map(id => {
        const p = state.products.find(x => x.id === id);
        return `<div>${p.name}</div>`;
      }).join("")}
    </div>
    ${renderNav("favorites")}
  `;
}

function renderProfile(app) {
  const user = Telegram.WebApp?.initDataUnsafe?.user;

  app.innerHTML = `
    <div class="topbar">–ü—Ä–æ—Ñ–∏–ª—å</div>
    <div class="content">
      ${user ? `
        <div>${user.first_name}</div>
        <div>@${user.username || ""}</div>
      ` : "–û—Ç–∫—Ä–æ–π –≤ Telegram"}
    </div>
    ${renderNav("profile")}
  `;
}

/* ---------------- ACTIONS ---------------- */

function addToCart(id) {
  state.cart.push(id);
  alert("–î–æ–±–∞–≤–ª–µ–Ω–æ");
}

/* ---------------- NAV BAR ---------------- */

function renderNav(active) {
  return `
    <div class="bottom-nav">
      <div class="nav-item ${active==='home'?'active':''}" onclick="navigate('home')">üè†<br>–ì–ª–∞–≤–Ω–∞—è</div>
      <div class="nav-item ${active==='favorites'?'active':''}" onclick="navigate('favorites')">‚ù§Ô∏è<br>–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</div>
      <div class="nav-item ${active==='cart'?'active':''}" onclick="navigate('cart')">üõí<br>–ö–æ—Ä–∑–∏–Ω–∞</div>
      <div class="nav-item ${active==='profile'?'active':''}" onclick="navigate('profile')">üë§<br>–ü—Ä–æ—Ñ–∏–ª—å</div>
    </div>
  `;
}

init();

if (window.Telegram && Telegram.WebApp) {
  Telegram.WebApp.expand();
}
</script>

</body>
</html>
