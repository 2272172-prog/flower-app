<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Flower Shop PRO</title>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>

<style>
body{
  margin:0;
  font-family:Arial,sans-serif;
  background:linear-gradient(135deg,#fff0f5,#ffe4ec);
  padding:20px;
}

header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  flex-wrap:wrap;
}

h1{margin:0;}

.controls{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}

input, select{
  padding:8px;
  border-radius:8px;
  border:1px solid #ddd;
}

button{
  cursor:pointer;
  border:none;
  border-radius:8px;
}

.primary{
  background:#e91e63;
  color:white;
  padding:8px 12px;
}

#catalog{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(250px,1fr));
  gap:20px;
  margin-top:20px;
}

.card{
  background:white;
  border-radius:16px;
  overflow:hidden;
  box-shadow:0 6px 20px rgba(0,0,0,.08);
  transition:.3s;
}

.card:hover{transform:translateY(-6px);}

.card img{
  width:100%;
  height:200px;
  object-fit:cover;
}

.card-content{padding:15px;}

.price{
  color:#e91e63;
  font-weight:bold;
}

.cart-btn{
  position:fixed;
  top:20px;
  right:20px;
  background:white;
  padding:10px 14px;
  border-radius:50px;
  box-shadow:0 4px 10px rgba(0,0,0,.1);
}

.cart-modal{
  display:none;
  position:fixed;
  right:20px;
  top:70px;
  width:340px;
  background:white;
  padding:20px;
  border-radius:16px;
  box-shadow:0 10px 25px rgba(0,0,0,.2);
  max-height:500px;
  overflow:auto;
}

.admin-panel{
  margin-top:20px;
  background:white;
  padding:15px;
  border-radius:12px;
  display:none;
}

@media(max-width:600px){
  .cart-modal{
    width:90%;
    right:5%;
  }
}
</style>
</head>
<body>

<header>
  <h1>üå∏ Flower Shop PRO</h1>

  <div class="controls">
    <input id="search" placeholder="–ü–æ–∏—Å–∫...">
    <select id="categoryFilter">
      <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
      <option value="bouquet">–ë—É–∫–µ—Ç—ã</option>
      <option value="box">–ö–æ—Ä–æ–±–∫–∏</option>
      <option value="wedding">–°–≤–∞–¥–µ–±–Ω—ã–µ</option>
    </select>
    <button id="loginBtn" class="primary">–í–æ–π—Ç–∏</button>
  </div>
</header>

<button class="cart-btn" onclick="toggleCart()">üõí <span id="cartCount">0</span></button>

<div id="catalog"></div>

<div class="cart-modal" id="cartModal">
  <h3>–ö–æ—Ä–∑–∏–Ω–∞</h3>
  <div id="cartItems"></div>
  <h4 id="cartTotal"></h4>
  <button class="primary" onclick="checkout()">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
</div>

<div class="admin-panel" id="adminPanel">
  <h3>–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</h3>
  <input id="name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ"><br><br>
  <input id="description" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ"><br><br>
  <input id="price" type="number" placeholder="–¶–µ–Ω–∞"><br><br>
  <input id="image" placeholder="URL –∫–∞—Ä—Ç–∏–Ω–∫–∏"><br><br>
  <select id="category">
    <option value="bouquet">–ë—É–∫–µ—Ç</option>
    <option value="box">–ö–æ—Ä–æ–±–∫–∞</option>
    <option value="wedding">–°–≤–∞–¥–µ–±–Ω—ã–π</option>
  </select><br><br>
  <button class="primary" onclick="addFlower()">–î–æ–±–∞–≤–∏—Ç—å</button>
</div>

<script>
const firebaseConfig = {
  apiKey:"–¢–í–û–ô_API_KEY",
  authDomain:"flower-app-5a32c.firebaseapp.com",
  projectId:"flower-app-5a32c"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const auth = firebase.auth();

let cart = JSON.parse(localStorage.getItem("cart")) || [];
updateCartUI();

function saveCart(){
  localStorage.setItem("cart",JSON.stringify(cart));
}

function toggleCart(){
  const modal=document.getElementById("cartModal");
  modal.style.display=modal.style.display==="block"?"none":"block";
}

function addToCart(item){
  cart.push(item);
  saveCart();
  updateCartUI();
}

function removeFromCart(i){
  cart.splice(i,1);
  saveCart();
  updateCartUI();
}

function updateCartUI(){
  document.getElementById("cartCount").innerText=cart.length;
  const div=document.getElementById("cartItems");
  div.innerHTML="";
  let total=0;
  cart.forEach((item,i)=>{
    total+=item.price;
    div.innerHTML+=`
      <div>
        ${item.name} ‚Äî ${item.price}‚ÇΩ
        <button onclick="removeFromCart(${i})">‚ùå</button>
      </div>`;
  });
  document.getElementById("cartTotal").innerText="–ò—Ç–æ–≥–æ: "+total+" ‚ÇΩ";
}

function checkout(){
  const total=cart.reduce((sum,i)=>sum+i.price,0);
  const text=cart.map(i=>i.name+" ‚Äî "+i.price+"‚ÇΩ").join("\n");
  window.open("https://t.me/vtaliy_gd?text="+encodeURIComponent("–ó–∞–∫–∞–∑:\n"+text+"\n\n–ò—Ç–æ–≥–æ: "+total+"‚ÇΩ"));
}

function renderFlowers(flowers){
  const catalog=document.getElementById("catalog");
  catalog.innerHTML="";
  flowers.forEach(doc=>{
    const f=doc.data();
    catalog.innerHTML+=`
      <div class="card">
        <img src="${f.image}">
        <div class="card-content">
          <h3>${f.name}</h3>
          <p>${f.description}</p>
          <div class="price">${f.price} ‚ÇΩ</div>
          <button class="primary" onclick='addToCart(${JSON.stringify(f)})'>–í –∫–æ—Ä–∑–∏–Ω—É</button>
        </div>
      </div>`;
  });
}

db.collection("flowers").onSnapshot(snapshot=>{
  let flowers=snapshot.docs;

  const search=document.getElementById("search").value.toLowerCase();
  const category=document.getElementById("categoryFilter").value;

  flowers=flowers.filter(doc=>{
    const f=doc.data();
    return (!search||f.name.toLowerCase().includes(search)) &&
           (!category||f.category===category);
  });

  renderFlowers(flowers);
});

document.getElementById("search").oninput=()=>{};
document.getElementById("categoryFilter").onchange=()=>{};

document.getElementById("loginBtn").onclick=()=>{
  const email=prompt("Email");
  const pass=prompt("Password");
  auth.signInWithEmailAndPassword(email,pass)
  .then(()=>{
    document.getElementById("adminPanel").style.display="block";
  })
  .catch(()=>alert("–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞"));
};

function addFlower(){
  db.collection("flowers").add({
    name:name.value,
    description:description.value,
    price:Number(price.value),
    image:image.value,
    category:category.value
  });
}
</script>

</body>
</html>
